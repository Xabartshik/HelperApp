<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:zxing="clr-namespace:ZXing.Net.Maui.Controls;assembly=ZXing.Net.MAUI.Controls"
             x:Class="HelperApp.Views.BarcodeScannerPage"
             Title="Сканирование штрих-кода"
             BackgroundColor="#1a1a2e">

    <Grid RowDefinitions="*,Auto,Auto" Padding="0">

        <!-- Камера для сканирования -->
        <zxing:CameraBarcodeReaderView
            Grid.Row="0"
            IsDetecting="{Binding IsScanning}"
            BarcodesDetected="OnBarcodesDetected"
            HorizontalOptions="FillAndExpand"
            VerticalOptions="FillAndExpand" />

        <!-- Рамка прицела в центре -->
        <Border
            Grid.Row="0"
            WidthRequest="300"
            HeightRequest="200"
            StrokeThickness="3"
            Stroke="#7c3aed"
            StrokeShape="RoundRectangle 12"
            BackgroundColor="Transparent"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            IsEnabled="False" />

        <!-- Информационная панель -->
        <VerticalStackLayout
            Grid.Row="1"
            Padding="20"
            Spacing="12"
            BackgroundColor="#2a2a3e">

            <!-- Код позиции -->
            <Label
                Text="{Binding PositionCode, StringFormat='Позиция: {0}'}"
                FontSize="14"
                FontAttributes="Bold"
                TextColor="#e0b0ff"
                HorizontalTextAlignment="Center"
                IsVisible="{Binding PositionCode, Converter={StaticResource NotNullOrEmptyConverter}}" />

            <!-- Статус сканирования -->
            <Label
                Text="{Binding StatusMessage}"
                FontSize="13"
                TextColor="{Binding StatusColor}"
                HorizontalTextAlignment="Center"
                LineBreakMode="WordWrap" />

            <!-- Отсканированный код (если есть) -->
            <Label
                Text="{Binding ScannedBarcode}"
                FontSize="16"
                FontAttributes="Bold"
                TextColor="#7c3aed"
                HorizontalTextAlignment="Center"
                IsVisible="{Binding ScannedBarcode, Converter={StaticResource NotNullOrEmptyConverter}}" />

        </VerticalStackLayout>

        <!-- Кнопка отмены -->
        <Button
            Grid.Row="2"
            Text="Отменить"
            Command="{Binding CancelCommand}"
            BackgroundColor="#3a3a55"
            TextColor="#ffffff"
            FontSize="14"
            CornerRadius="8"
            Padding="16"
            Margin="20,0,20,20" />

    </Grid>

</ContentPage>
