<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HelperApp.Views.InventoryDetailsPage"
             Title="Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸"
             BackgroundColor="#1a1a2e"
             Padding="0">

    <ScrollView>
        <VerticalStackLayout Spacing="0" Padding="0">

            <!-- Ð’ÐµÑ€Ñ…Ð½ÑÑ Ñ‡Ð°ÑÑ‚ÑŒ - Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <VerticalStackLayout Padding="20" Spacing="12" BackgroundColor="#2a2a3e">

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                    <Button
                        Grid.Column="0"
                        Text="â† ÐÐ°Ð·Ð°Ð´"
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="#7c3aed"
                        TextColor="#ffffff"
                        FontSize="12"
                        CornerRadius="6"
                        Padding="12,8" />

                    <Button
                        Grid.Column="1"
                        Text="âœ“ Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ"
                        Command="{Binding CompleteInventoryCommand}"
                        BackgroundColor="#22c55e"
                        TextColor="#ffffff"
                        FontSize="12"
                        FontAttributes="Bold"
                        CornerRadius="6"
                        Padding="12,8" />
                </Grid>

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                <Label
                    Text="{Binding ZoneCodeShortDescription}"
                    FontSize="18"
                    FontAttributes="Bold"
                    TextColor="#e0b0ff"
                    LineBreakMode="WordWrap" />

                <!-- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="10" RowSpacing="8">

                    <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="4">
                        <Label Text="Ð”Ð°Ñ‚Ð° Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ" FontSize="11" TextColor="#888888" />
                        <Label
                            Text="{Binding InitiatedAt, StringFormat='{0:dd.MM.yyyy HH:mm}'}"
                            FontSize="13"
                            FontAttributes="Bold"
                            TextColor="#ffffff" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="4">
                        <Label Text="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ" FontSize="11" TextColor="#888888" />
                        <Label
                            Text="{Binding Status}"
                            FontSize="13"
                            FontAttributes="Bold"
                            TextColor="#7c3aed" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="4">
                        <Label Text="ÐŸÑ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð¾ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¹" FontSize="11" TextColor="#888888" />
                        <Label FontSize="13" FontAttributes="Bold" TextColor="#ffffff">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding ScannedItemsCount}" />
                                    <Span Text=" / " />
                                    <Span Text="{Binding TotalItems}" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Row="1" Grid.Column="1" Spacing="4">
                        <Label Text="Ð Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ" FontSize="11" TextColor="#888888" />
                        <Label
                            Text="{Binding VarianceCount}"
                            FontSize="13"
                            FontAttributes="Bold"
                            TextColor="#ff6b6b"
                            IsVisible="{Binding HasVariances}" />
                        <Label
                            Text="0"
                            FontSize="13"
                            FontAttributes="Bold"
                            TextColor="#7c3aed"
                            IsVisible="{Binding HasVariances, Converter={StaticResource InvertedBoolConverter}}" />
                    </VerticalStackLayout>

                </Grid>

            </VerticalStackLayout>

            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð³Ñ€ÑƒÐ¿Ð¿ -->
            <Label
                Text="ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸"
                FontSize="14"
                FontAttributes="Bold"
                TextColor="#e0b0ff"
                Padding="20,12,20,8"
                BackgroundColor="#1a1a2e" />

            <VerticalStackLayout
                BindableLayout.ItemsSource="{Binding GroupedInventoryItems}"
                Spacing="0"
                Padding="0">

                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <VerticalStackLayout Spacing="0" Padding="10,6,10,0">

                            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ -->
                            <Border
                                Padding="15,12"
                                StrokeThickness="1"
                                Stroke="#7c3aed"
                                BackgroundColor="#3a3a55"
                                StrokeShape="RoundRectangle 8">

                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ToggleExpandCommand}" />
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="*,Auto">
                                    <VerticalStackLayout Grid.Column="0" Spacing="4">
                                        <Label
                                            Text="{Binding GroupHeader}"
                                            FontSize="14"
                                            FontAttributes="Bold"
                                            TextColor="#ffffff" />
                                        <Label FontSize="11" TextColor="#b0b0b0">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="ÐŸÑ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð¾: " />
                                                    <Span Text="{Binding ScannedCount}" />
                                                    <Span Text=" Ð¸Ð· " />
                                                    <Span Text="{Binding ItemCount}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </VerticalStackLayout>

                                    <Label
                                        Grid.Column="1"
                                        Text="â–¼"
                                        FontSize="16"
                                        TextColor="#7c3aed"
                                        VerticalOptions="Center"
                                        IsVisible="{Binding IsExpanded, Converter={StaticResource InvertedBoolConverter}}" />
                                    <Label
                                        Grid.Column="1"
                                        Text="â–²"
                                        FontSize="16"
                                        TextColor="#7c3aed"
                                        VerticalOptions="Center"
                                        IsVisible="{Binding IsExpanded}" />
                                </Grid>

                            </Border>

                            <!-- Ð Ð°ÑÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ð¹ Ð±Ð»Ð¾Ðº -->
                            <VerticalStackLayout
                                Spacing="8"
                                Padding="0,8,0,0"
                                IsVisible="{Binding IsExpanded}">

                                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ -->
                                <Button
                                    Text="ðŸ“· Ð¡ÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                                    Command="{Binding ScanItemsCommand}"
                                    BackgroundColor="#7c3aed"
                                    TextColor="#ffffff"
                                    FontSize="13"
                                    CornerRadius="6"
                                    Padding="12,8"
                                    HorizontalOptions="Fill"
                                    Margin="0,0,0,8" />

                                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² -->
                                <VerticalStackLayout
                                    BindableLayout.ItemsSource="{Binding Items}"
                                    Spacing="6">

                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Padding="15"
                                                StrokeThickness="1"
                                                Stroke="#3a3a55"
                                                BackgroundColor="#2a2a3e"
                                                StrokeShape="RoundRectangle 8">

                                                <VerticalStackLayout Spacing="8">

                                                    <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ð° -->
                                                    <Label
                                                        Text="{Binding ItemName}"
                                                        FontSize="13"
                                                        FontAttributes="Bold"
                                                        TextColor="#ffffff"
                                                        LineBreakMode="WordWrap" />

                                                    <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ -->
                                                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">

                                                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                                                            <Label Text="ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ð¾Ðµ" FontSize="10" TextColor="#888888" />
                                                            <Label
                                                                Text="{Binding ExpectedQuantityDisplay}"
                                                                FontSize="12"
                                                                FontAttributes="Bold"
                                                                TextColor="#7c3aed" />
                                                        </VerticalStackLayout>

                                                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                                                            <Label Text="Ð¤Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ" FontSize="10" TextColor="#888888" />
                                                            <Label
                                                                Text="{Binding ActualQuantityDisplay}"
                                                                FontSize="12"
                                                                FontAttributes="Bold"
                                                                TextColor="{Binding ActualQuantityColor}" />
                                                        </VerticalStackLayout>

                                                    </Grid>

                                                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ (Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾, Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð², Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ, ÐµÑÐ»Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€ Ð½Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½) -->
                                                    <Grid 
                                                        ColumnDefinitions="*,*" 
                                                        ColumnSpacing="8" 
                                                        IsVisible="{Binding IsCompleted, Converter={StaticResource InvertedBoolConverter}}">

                                                        <Button
                                                            Grid.Column="0"
                                                            Text="âŒ ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
                                                            Command="{Binding MarkAsAbsentCommand}"
                                                            BackgroundColor="#ff6b6b"
                                                            TextColor="#ffffff"
                                                            FontSize="11"
                                                            CornerRadius="6"
                                                            Padding="8,6" />

                                                        <Button
                                                            Grid.Column="1"
                                                            Text="âœï¸ Ð’Ð²ÐµÑÑ‚Ð¸"
                                                            Command="{Binding EnterManuallyCommand}"
                                                            BackgroundColor="#7c3aed"
                                                            TextColor="#ffffff"
                                                            FontSize="11"
                                                            CornerRadius="6"
                                                            Padding="8,6" />
                                                    </Grid>

                                                    <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
                                                    <Label
                                                        Text="{Binding StatusText}"
                                                        FontSize="11"
                                                        TextColor="{Binding ActualQuantityColor}"
                                                        FontAttributes="Bold"
                                                        IsVisible="{Binding IsCompleted}" />

                                                </VerticalStackLayout>

                                            </Border>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>

                                </VerticalStackLayout>

                            </VerticalStackLayout>

                        </VerticalStackLayout>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>

            </VerticalStackLayout>

            <!-- Empty State -->
            <VerticalStackLayout
                IsVisible="False"
                BackgroundColor="#1a1a2e"
                Padding="20"
                Spacing="8"
                VerticalOptions="Start"
                HorizontalOptions="CenterAndExpand">

                <VerticalStackLayout.Triggers>
                    <DataTrigger TargetType="VerticalStackLayout"
                                 Binding="{Binding GroupedInventoryItems.Count}"
                                 Value="0">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                </VerticalStackLayout.Triggers>

                <Label
                    Text="ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹"
                    FontSize="14"
                    TextColor="#b0b0b0"
                    HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
